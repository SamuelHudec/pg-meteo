esphome:
  name: meteo_sonda
  friendly_name: Meteo sonda
  on_boot:
    priority: -10
    then:
      # nech sa stihne Wi-Fi + DNS
      - delay: 3s

      # skontroluj manifest
      - update.check: fw_update

      # ak je nová verzia → hneď update
      - if:
          condition:
            update.is_available: fw_update
          then:
            - logger.log: "HTTP OTA: New firmware available -> updating now"
            - update.perform: fw_update

      # ak update nebol, pokračuj v normálnom behu (senzory / publish)
      - logger.log: "Boot: no update (or after update). Continue."

esp32:
  board: esp32-c3-devkitm-1
  framework:
    type: esp-idf

logger:

# Ak chceš len MQTT (bez HA API), API môžeš zmazať.
api:

# Wi-Fi: minimálny setup, doplň svoje SSID/PASS
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  # fallback AP (ak sa nevie pripojiť)
  ap:
    ssid: "meteo_sonda_fallback"
    password: !secret fallback_ap_password

captive_portal:

# HTTP klient pre sťahovanie manifestu + FW
http_request:
  # GitHub Releases redirecty môžu potrebovať väčší buffer, pre GitHub Pages stačí malé.
  max_response_buffer_size: 2kb

# OTA implementované cez http_request (pull OTA)
ota:
  - platform: http_request
    id: ota_http

# Update entita, ktorá ukazuje dostupnosť a drží "current version"
update:
  - platform: http_request
    id: fw_update
    name: "Firmware Update"
    source: "https://YOUR_GITHUB_PAGES/firmware/meteo_sonda/manifest.json"
    update_interval: 0s   # necheckuj periodicky, len pri boote

# Deep sleep (meteosonda)
deep_sleep:
  id: sleep_ctrl
  run_duration: 30s
  sleep_duration: 10min
